<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPG Converter 4.0.0 - Modular Edition</title>
    
    <!-- External Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">üì∫</div>
                    <span>EPG Converter</span>
                    <span class="badge badge-warning">v4.0.0</span>
                    <span class="badge badge-success">Modular Edition</span>
                </div>
                
                <div class="header-actions">
                    <div class="tooltip">
                        <button class="btn btn-ghost btn-icon" id="shortcuts-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="11" width="18" height="10" rx="2" ry="2"/>
                                <path d="M7 11V7a5 5 0 0110 0v4"/>
                            </svg>
                        </button>
                        <span class="tooltip-content">Shortcuts (Ctrl+/)</span>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Main Content -->
        <div class="main-wrapper">
            <!-- Sidebar -->
            <aside class="sidebar">
                <h3 class="sidebar-title">Passaggi Conversione</h3>
                <div class="step-list" id="step-list">
                    <div class="step-item active" data-step="1">
                        <div class="step-number">1</div>
                        <div class="step-label">Seleziona Canale</div>
                    </div>
                    <div class="step-item" data-step="2">
                        <div class="step-number">2</div>
                        <div class="step-label">Carica File Excel</div>
                    </div>
                    <div class="step-item" data-step="3">
                        <div class="step-number">3</div>
                        <div class="step-label">Configura Opzioni</div>
                    </div>
                    <div class="step-item" data-step="4">
                        <div class="step-number">4</div>
                        <div class="step-label">Converti e Scarica</div>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h4 class="sidebar-title">Sessioni Recenti</h4>
                    <div id="recent-sessions" class="text-sm text-secondary">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </aside>
            
            <!-- Main Content Area -->
            <main class="main-content">
                <!-- Step 1: Channel Selection -->
                <div class="card step-content" data-step="1">
                    <div class="card-header">
                        <h2 class="card-title">Seleziona il Canale</h2>
                        <p class="card-description">Scegli il canale per cui vuoi generare l'EPG</p>
                    </div>
                    
                    <div class="channel-selector">
                        <div class="channel-card classcnbc" data-channel="classcnbc" id="channel-classcnbc">
                            <div class="channel-icon">üìä</div>
                            <h3 class="channel-name">Class CNBC</h3>
                            <p class="channel-info">Business & Finance</p>
                            <p class="text-xs mt-2 opacity-50">Un file per ogni cambio data</p>
                        </div>
                        
                        <div class="channel-card tvmoda" data-channel="tvmoda" id="channel-tvmoda">
                            <div class="channel-icon">üëó</div>
                            <h3 class="channel-name">Class TV Moda</h3>
                            <p class="channel-info">Fashion & Style</p>
                            <p class="text-xs mt-2 opacity-50">Un file per ogni foglio con data</p>
                        </div>
                    </div>
                </div>
                
                <!-- Step 2: File Upload -->
                <div class="card step-content hidden" data-step="2">
                    <div class="card-header">
                        <h2 class="card-title">Carica File Excel</h2>
                        <p class="card-description">Trascina o seleziona il file EPG in formato Excel</p>
                    </div>
                    
                    <div class="upload-area" id="uploadArea">
                        <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        <h3 class="upload-text">Trascina qui il file Excel</h3>
                        <p class="upload-hint">oppure clicca per selezionarlo</p>
                        <button class="btn btn-primary" id="select-file-btn">
                            Seleziona File
                        </button>
                        <input type="file" id="fileInput" accept=".xlsx,.xls" class="hidden" />
                    </div>
                    
                    <div id="file-info" class="hidden mt-4"></div>
                    
                    <!-- Date Preview Section -->
                    <div id="date-preview" class="date-preview hidden">
                        <h3 class="date-preview-title">üìÖ Date rilevate nel palinsesto</h3>
                        <div id="date-grid" class="date-grid">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    
                    <!-- Navigation button -->
                    <div class="mt-4 text-right hidden" id="step2-nav">
                        <button class="btn btn-primary" id="nav-step3">
                            Configura Opzioni
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6"/>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- Step 3: Configuration -->
                <div class="card step-content hidden" data-step="3">
                    <div class="card-header">
                        <h2 class="card-title">Configurazione</h2>
                        <p class="card-description">Personalizza le impostazioni di conversione</p>
                    </div>
                    
                    <div class="tabs">
                        <div class="tab active" data-tab="general">Generale</div>
                        <div class="tab" data-tab="advanced">Avanzate</div>
                        <div class="tab" data-tab="icons">Icone Format</div>
                    </div>
                    
                    <!-- General Tab -->
                    <div class="tab-content" data-tab="general">
                        <div class="grid grid-2">
                            <div class="form-group">
                                <label class="form-label" for="channelId">ID Canale</label>
                                <input type="text" id="channelId" class="form-control" value="ClassCNBC" />
                                <p class="form-hint">Identificativo univoco del canale</p>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="channelName">Nome Canale</label>
                                <input type="text" id="channelName" class="form-control" value="Class CNBC" />
                                <p class="form-hint">Nome visualizzato nell'EPG</p>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="timezone">Timezone Input</label>
                            <select id="timezone" class="form-control">
                                <option value="1" selected>+01:00 (Italia/CET)</option>
                                <option value="0">+00:00 (UTC/GMT)</option>
                                <option value="2">+02:00 (Italia Estate/CEST)</option>
                            </select>
                            <p class="form-hint">Gli orari verranno convertiti in UTC</p>
                        </div>
                        
                        <div class="form-group">
                            <div class="toggle-wrapper">
                                <div class="toggle active" data-option="fillGaps" id="fillGaps">
                                    <div class="toggle-slider"></div>
                                </div>
                                <label class="form-label" style="margin: 0;">Riempi automaticamente i gap temporali</label>
                            </div>
                            <p class="form-hint mt-1">Estende la durata dei programmi per coprire i buchi nella programmazione</p>
                        </div>
                        
                        <div class="form-group">
                            <div class="toggle-wrapper">
                                <div class="toggle active" data-option="useRealDates" id="useRealDates">
                                    <div class="toggle-slider"></div>
                                </div>
                                <label class="form-label" style="margin: 0;">Usa date reali del palinsesto</label>
                            </div>
                            <p class="form-hint mt-1">Utilizza le date effettive del file Excel invece di proiettare su date future</p>
                        </div>
                    </div>
                    
                    <!-- Advanced Tab -->
                    <div class="tab-content hidden" data-tab="advanced">
                        <div class="form-group">
                            <label class="form-label" for="iconUrl">URL Base Icone</label>
                            <input type="text" id="iconUrl" class="form-control" value="https://df4c28da231b4c30821e57d5f2111c23.msvdn.net/feeds/epg/ClassCNBC_IT_samsung/Images/" readonly />
                            <p class="form-hint">URL base per le icone dei format</p>
                        </div>
                        
                        <div class="grid grid-2">
                            <div class="form-group">
                                <div class="toggle-wrapper">
                                    <div class="toggle" data-option="validateData" id="validateData">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <label class="form-label" style="margin: 0;">Validazione dati</label>
                                </div>
                                <p class="form-hint mt-1">Rimuovi duplicati e sovrapposizioni</p>
                            </div>
                            
                            <div class="form-group">
                                <div class="toggle-wrapper">
                                    <div class="toggle" data-option="debugMode" id="debugMode">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <label class="form-label" style="margin: 0;">Modalit√† debug</label>
                                </div>
                                <p class="form-hint mt-1">Log dettagliati nella console</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Icons Tab -->
                    <div class="tab-content hidden" data-tab="icons">
                        <div class="mb-4">
                            <button class="btn btn-secondary btn-sm" id="scan-formats">
                                üîç Verifica Format Mancanti
                            </button>
                            <button class="btn btn-secondary btn-sm" id="export-icons">
                                üíæ Esporta Mappatura
                            </button>
                            <button class="btn btn-secondary btn-sm" id="import-icons">
                                üìÇ Importa Mappatura
                            </button>
                            <input type="file" id="importFile" accept=".json" class="hidden" />
                        </div>
                        
                        <div class="icon-grid" id="iconList">
                            <!-- Populated by JS -->
                        </div>
                        
                        <div class="card mt-4" style="background-color: var(--bg-secondary);">
                            <h4 class="font-semibold mb-2">Aggiungi Nuovo Format</h4>
                            <div class="grid grid-2">
                                <input type="text" id="newFormatName" class="form-control" placeholder="Nome format" />
                                <input type="text" id="newFormatIcon" class="form-control" placeholder="nome-file.jpg" />
                            </div>
                            <button class="btn btn-primary btn-sm mt-2" id="add-format">
                                + Aggiungi Format
                            </button>
                        </div>
                    </div>
                    
                    <!-- Navigation buttons -->
                    <div class="mt-4 flex justify-between">
                        <button class="btn btn-secondary" id="nav-step2">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="15 18 9 12 15 6"/>
                            </svg>
                            Indietro
                        </button>
                        <button class="btn btn-primary" id="nav-step4">
                            Procedi alla Conversione
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6"/>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- Step 4: Convert & Download -->
                <div class="card step-content hidden" data-step="4">
                    <div class="card-header">
                        <h2 class="card-title">Conversione</h2>
                        <p class="card-description">Genera il file XMLTV</p>
                    </div>
                    
                    <div class="text-center">
                        <button class="btn btn-primary" id="convertBtn" disabled>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="16 16 12 12 8 16"/>
                                <line x1="12" y1="12" x2="12" y2="21"/>
                                <path d="M20.39 18.39A5 5 0 0018 9h-1.26A8 8 0 103 16.3"/>
                                <polyline points="16 16 12 12 8 16"/>
                            </svg>
                            Converti in XMLTV
                        </button>
                    </div>
                    
                    <div id="conversion-progress" class="hidden mt-4">
                        <div class="progress-wrapper">
                            <div class="progress-label">
                                <span>Conversione in corso...</span>
                                <span id="progress-percent">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                        <div id="multi-progress" class="multi-progress mt-4 hidden">
                            <!-- Populated dynamically -->
                        </div>
                    </div>
                    
                    <div id="status" class="mt-4"></div>
                    
                    <div id="downloadSection" class="hidden mt-4 text-center slide-up"></div>
                    
                    <!-- Navigation button -->
                    <div class="mt-4 text-left">
                        <button class="btn btn-secondary" id="nav-step3-back">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="15 18 9 12 15 6"/>
                            </svg>
                            Torna alle Opzioni
                        </button>
                    </div>
                </div>
                
                <!-- Console -->
                <div class="card mt-4">
                    <div class="console-header">
                        <span class="console-title">üìü Console Output</span>
                        <div class="console-actions">
                            <button class="btn btn-ghost btn-icon" id="clear-log">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"/>
                                    <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                                </svg>
                            </button>
                            <button class="btn btn-ghost btn-icon" id="export-log">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="console" id="log"></div>
                </div>
            </main>
        </div>
        
        <!-- Footer -->
        <footer class="footer">
            <p>EPG Converter v4.0.0 - Modular Edition | Sviluppato da <strong>Telesia S.p.A.</strong> ¬© 2025 | Ultimo aggiornamento: 10/06/2025</p>
        </footer>
    </div>
    
    <!-- Load modular JavaScript -->
    <script type="module" src="js/app.js"></script>
</body>
</html>