<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPG Converter 4.0 - Excel to XMLTV</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>EPG Converter <span class="version">v4.0</span></h1>
            <p class="subtitle">Conversione palinsesti da Excel a XMLTV</p>
        </header>

        <!-- Main Content -->
        <div class="main-layout">
            <!-- Sidebar Navigation -->
            <aside class="sidebar">
                <nav class="step-nav">
                    <div class="step-item active" data-step="1">
                        <div class="step-number">1</div>
                        <div class="step-label">Seleziona Canale</div>
                    </div>
                    <div class="step-item" data-step="2">
                        <div class="step-number">2</div>
                        <div class="step-label">Carica File</div>
                    </div>
                    <div class="step-item" data-step="3">
                        <div class="step-number">3</div>
                        <div class="step-label">Configura</div>
                    </div>
                    <div class="step-item" data-step="4">
                        <div class="step-number">4</div>
                        <div class="step-label">Converti</div>
                    </div>
                </nav>

                <!-- Recent Sessions -->
                <div class="recent-sessions">
                    <h3>Sessioni Recenti</h3>
                    <div id="recent-sessions">
                        <p class="text-xs opacity-50">Nessuna sessione recente</p>
                    </div>
                </div>

                <!-- Shortcuts -->
                <button id="shortcuts-btn" class="btn btn-ghost btn-sm mt-4">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                        <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                    </svg>
                    Scorciatoie
                </button>
            </aside>

            <!-- Content Area -->
            <main class="content">
                <!-- Step 1: Channel Selection -->
                <section class="step-content" data-step="1">
                    <h2 class="step-title">Seleziona il Canale</h2>
                    
                    <div class="channel-grid">
                        <div class="channel-card" data-channel="classcnbc">
                            <div class="channel-logo">
                                <img src="images/class-cnbc-logo.png" alt="Class CNBC">
                            </div>
                            <h3>Class CNBC</h3>
                            <p>Canale economico-finanziario</p>
                        </div>
                        
                        <div class="channel-card" data-channel="tvmoda">
                            <div class="channel-logo">
                                <img src="images/tv-moda-logo.png" alt="TV Moda">
                            </div>
                            <h3>Class TV Moda</h3>
                            <p>Canale fashion & lifestyle</p>
                        </div>
                    </div>
                </section>

                <!-- Step 2: File Upload -->
                <section class="step-content hidden" data-step="2">
                    <h2 class="step-title">Carica File Excel</h2>
                    
                    <div id="uploadArea" class="upload-area">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3">
                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        <p>Trascina qui il file Excel o clicca per selezionare</p>
                        <button id="select-file-btn" class="btn btn-primary">Seleziona File</button>
                        <input type="file" id="fileInput" accept=".xlsx,.xls" style="display: none;">
                    </div>
                    
                    <div id="file-info" class="file-info hidden"></div>
                    <div id="date-preview" class="date-preview hidden">
                        <h3>Date Rilevate</h3>
                        <div id="date-grid" class="date-grid"></div>
                    </div>
                    
                    <div class="nav-buttons">
                        <button id="step2-nav" class="btn btn-primary hidden">Continua</button>
                    </div>
                </section>

                <!-- Step 3: Configuration -->
                <section class="step-content hidden" data-step="3">
                    <h2 class="step-title">Configurazione</h2>
                    
                    <!-- Tabs -->
                    <div class="tabs">
                        <div class="tab active" data-tab="general">Generale</div>
                        <div class="tab" data-tab="icons">Gestione Icone</div>
                        <div class="tab" data-tab="advanced">Avanzate</div>
                    </div>

                    <!-- General Tab -->
                    <div class="tab-content" data-tab="general">
                        <div class="form-group">
                            <label for="channelId">ID Canale</label>
                            <input type="text" id="channelId" class="form-control" value="">
                            <small>Identificativo univoco del canale nel file XMLTV</small>
                        </div>

                        <div class="form-group">
                            <label for="channelName">Nome Canale</label>
                            <input type="text" id="channelName" class="form-control" value="">
                            <small>Nome visualizzato del canale</small>
                        </div>

                        <div class="form-group">
                            <label for="timezone">Timezone</label>
                            <select id="timezone" class="form-control">
                                <option value="0">+00:00 (UTC)</option>
                                <option value="1">+01:00 (Italia Inverno/CET)</option>
                                <option value="2" selected>+02:00 (Italia Estate/CEST)</option>
                                <option value="-5">-05:00 (EST)</option>
                                <option value="-8">-08:00 (PST)</option>
                            </select>
                            <small>Timezone del palinsesto Excel (verrà convertito in UTC)</small>
                        </div>

                        <div class="form-group">
                            <label for="iconUrl">URL Base Icone</label>
                            <input type="text" id="iconUrl" class="form-control" value="">
                            <small>URL base per le icone dei programmi</small>
                        </div>
                    </div>

                    <!-- Icons Tab -->
                    <div class="tab-content hidden" data-tab="icons">
                        <div class="icon-tools">
                            <button id="scan-formats" class="btn btn-secondary">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"/>
                                    <path d="m21 21-4.35-4.35"/>
                                </svg>
                                Verifica format mancanti
                            </button>
                            <button id="export-icons" class="btn btn-secondary">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                Esporta mappatura
                            </button>
                            <button id="import-icons" class="btn btn-secondary">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                                    <polyline points="17 8 12 3 7 8"/>
                                    <line x1="12" y1="3" x2="12" y2="15"/>
                                </svg>
                                Importa mappatura
                            </button>
                            <input type="file" id="importFile" accept=".json" style="display: none;">
                        </div>

                        <!-- Scan Results -->
                        <div id="scan-result" class="hidden mt-3"></div>

                        <!-- Add New Format -->
                        <div class="add-format-section">
                            <h3>Aggiungi Nuovo Format</h3>
                            <div class="form-row">
                                <input type="text" id="newFormatName" placeholder="Nome format" class="form-control">
                                <input type="text" id="newFormatIcon" placeholder="nome-icona.jpg" class="form-control">
                                <button id="add-format" class="btn btn-primary">Aggiungi</button>
                            </div>
                        </div>

                        <!-- Icon List -->
                        <div class="icon-list-container">
                            <h3>Mappatura Format → Icone</h3>
                            <div id="iconList" class="icon-list"></div>
                        </div>
                    </div>

                    <!-- Advanced Tab -->
                    <div class="tab-content hidden" data-tab="advanced">
                        <div class="option-group">
                            <div class="option-item">
                                <div>
                                    <strong>Gap Filling</strong>
                                    <p class="text-sm">Riempi automaticamente i buchi nella programmazione</p>
                                </div>
                                <div id="fillGaps" class="toggle active" data-option="fillGaps"></div>
                            </div>

                            <div class="option-item">
                                <div>
                                    <strong>Validazione Dati</strong>
                                    <p class="text-sm">Verifica la coerenza dei dati durante la conversione</p>
                                </div>
                                <div id="validateData" class="toggle" data-option="validateData"></div>
                            </div>

                            <div class="option-item">
                                <div>
                                    <strong>Modalità Debug</strong>
                                    <p class="text-sm">Log dettagliato per diagnostica avanzata</p>
                                </div>
                                <div id="debugMode" class="toggle" data-option="debugMode"></div>
                            </div>
                        </div>
                    </div>

                    <div class="nav-buttons">
                        <button id="nav-step3" class="btn btn-primary">Procedi alla conversione</button>
                    </div>
                </section>

                <!-- Step 4: Convert -->
                <section class="step-content hidden" data-step="4">
                    <h2 class="step-title">Conversione</h2>
                    
                    <div id="status"></div>

                    <!-- Conversion Progress -->
                    <div id="conversion-progress" class="conversion-progress hidden">
                        <h3>Conversione in corso...</h3>
                        <div class="progress-bar">
                            <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <div class="progress-text">
                            <span id="progress-percent">0%</span>
                        </div>
                        <div id="multi-progress" class="multi-progress hidden"></div>
                    </div>

                    <!-- Console -->
                    <div class="console-container">
                        <div class="console-header">
                            <h3>Console</h3>
                            <div class="console-actions">
                                <button id="clear-log" class="btn btn-ghost btn-sm">Pulisci</button>
                                <button id="export-log" class="btn btn-ghost btn-sm">Esporta</button>
                            </div>
                        </div>
                        <pre id="log" class="console-log"></pre>
                    </div>

                    <div class="action-buttons">
                        <button id="convertBtn" class="btn btn-success" disabled>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 11 12 14 22 4"/>
                                <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/>
                            </svg>
                            Converti in XMLTV
                        </button>
                        <button id="nav-step4" class="btn btn-secondary">
                            ← Torna alla configurazione
                        </button>
                    </div>

                    <!-- Download Section -->
                    <div id="downloadSection" class="download-section hidden"></div>
                </section>
            </main>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>EPG Converter v4.0.0 - Ultimo aggiornamento: 10/06/2025</p>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>
